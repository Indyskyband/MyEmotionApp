<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Files</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <style>
        /* --- CSS ‡πÄ‡∏î‡∏¥‡∏° --- */
        .upload-layout { padding-top: 50px; justify-content: flex-start; }
        .upload-title { font-size: 28px; font-weight: 800; color: #000; margin-bottom: 20px; }
        .upload-desc { font-size: 14px; color: #555; text-align: center; width: 80%; line-height: 1.5; margin-bottom: 40px; }

        /* STATE 1: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå */
        #step-1-select { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .upload-circle-btn { width: 100px; height: 100px; background-color: #1A1A1A; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.15); transition: transform 0.1s; }
        .upload-circle-btn:active { transform: scale(0.95); }
        .upload-label-text { font-size: 22px; font-weight: 700; color: #000; margin-top: 20px; margin-bottom: 5px; }
        .upload-hint { font-size: 14px; color: #666; font-weight: 400; }
        #file-input { display: none; }

        /* STATE 2: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î */
        #step-2-loading { display: none; flex-direction: column; align-items: center; width: 100%; margin-top: 20px; }
        .loading-percent { font-size: 60px; font-weight: 800; color: #1A1A1A; margin-bottom: 10px; }
        .loading-text { font-size: 24px; font-weight: 700; color: #000; margin-bottom: 10px; }
        .loading-sub { font-size: 14px; color: #666; }

        /* STATE 3: ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô */
        #step-3-completed { display: none; flex-direction: column; align-items: center; width: 100%; }
        .check-circle { width: 100px; height: 100px; border: 6px solid #1A1A1A; border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-bottom: 20px; }
        .completed-text { font-size: 24px; font-weight: 700; color: #000; text-align: center; line-height: 1.3; }

        /* --- ‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á (‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏Ñ‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á) --- */
        #main-button {
            bottom: 40px !important;
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            color: #1A1A1A !important;
            cursor: pointer;
            border: none;
            /* ‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î */
            background: linear-gradient(90deg, #FFB6B9 0%, #FFDAC1 100%) !important;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="card upload-layout">
            
            <h1 class="upload-title">Files Upload</h1>

            <p class="upload-desc">
                Add your file here, and you can upload<br>
                up 5s maximum file size: 50 MB
            </p>

            <div id="step-1-select">
                <label for="file-input" class="upload-circle-btn">
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                </label>
                <input type="file" id="file-input" accept="video/*,audio/*">
                <div class="upload-label-text">Upload Files</div>
                <div class="upload-hint">Tap to select files</div>
            </div>

            <div id="step-2-loading">
                <div class="loading-percent">1%</div>
                <div class="loading-text">Loading</div>
                <div class="loading-sub">Please wait...</div>
            </div>

            <div id="step-3-completed">
                <div class="check-circle">
                    <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="#1A1A1A" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                </div>
                <div class="completed-text">Upload Files<br>Completed</div>
            </div>

            <button id="main-button" class="btn-start">Back</button>

        </div>
    </div>

    <script>
        const fileInput = document.getElementById('file-input');
        const stepSelect = document.getElementById('step-1-select');
        const stepLoading = document.getElementById('step-2-loading');
        const stepCompleted = document.getElementById('step-3-completed');
        const percentText = document.querySelector('.loading-percent');
        
        // üî• ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
        const mainBtn = document.getElementById('main-button');

        // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Initial State) ---
        // ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô "Back" ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Home
        mainBtn.innerText = "Back";
        mainBtn.onclick = function() {
            window.location.href = "{{ url_for('home') }}";
        };

        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå
        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) { checkFileDuration(file); }
        });

        function checkFileDuration(file) {
            // (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏ä‡πá‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ 5 ‡∏ß‡∏¥ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°...)
            const elementType = file.type.startsWith('audio') ? 'audio' : 'video';
            const media = document.createElement(elementType);
            media.preload = 'metadata';
            media.onloadedmetadata = function() {
                window.URL.revokeObjectURL(media.src);
                if (media.duration > 5.5) {
                    alert("‚ö†Ô∏è File is too long!"); fileInput.value = "";
                } else {
                    startLoadingSimulation(file);
                }
            }
            media.src = URL.createObjectURL(file);
        }

        function startLoadingSimulation(file) {
            stepSelect.style.display = "none";
            stepLoading.style.display = "flex";

            // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô "Cancel"
            mainBtn.innerText = "Cancel";
            mainBtn.onclick = function() { window.location.reload(); }; // ‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä

            let progress = 1;
            const interval = setInterval(() => {
                progress += Math.floor(Math.random() * 5) + 2;
                if (progress > 100) progress = 100;
                percentText.innerText = progress + "%";
                if (progress === 100) {
                    clearInterval(interval);
                    setTimeout(() => { showCompletedState(file); }, 500);
                }
            }, 60);
        }

        function showCompletedState(file) {
            stepLoading.style.display = "none";
            stepCompleted.style.display = "flex";

            // üî• ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô "Start"
            mainBtn.innerText = "Start";
            mainBtn.onclick = function() {
                window.location.href = "{{ url_for('processing') }}"; // ‡∏Å‡∏î‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Processing
            };
        }
    </script>

</body>
</html>